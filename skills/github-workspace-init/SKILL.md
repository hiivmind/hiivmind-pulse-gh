---
name: hiivmind-github-workspace-init
description: Initialize a GitHub workspace configuration in the current repository. Creates .hiivmind/github/ with config files for caching org/project metadata. Use as the first step when setting up hiivmind-github-skills for a project.
---

# GitHub Workspace Initializer

Create a workspace configuration in the current repository to cache GitHub organization/project metadata for simplified operations.

## Process

```
1. CHECK        →  2. GATHER      →  3. VERIFY     →  4. CREATE     →  5. GITIGNORE
   (existing?)       (workspace)       (access)        (files)          (suggest)
```

**Note:** After initializing, run `hiivmind-github-workspace-analyze` to discover and cache project structure.

## Phase 1: Check Existing

Before proceeding, check if configuration already exists:

```bash
if [[ -f ".hiivmind/github/config.yaml" ]]; then
    echo "Workspace already initialized."
    echo "To reinitialize, remove .hiivmind/github/ first."
    cat .hiivmind/github/config.yaml
    exit 0
fi
```

If a symlink exists, check where it points:
```bash
if [[ -L ".hiivmind" ]]; then
    echo "Found symlink: .hiivmind -> $(readlink .hiivmind)"
    echo "This repository uses shared workspace configuration."
fi
```

## Phase 2: Gather Information

Collect workspace details from the user:

| Input | Question | Options |
|-------|----------|---------|
| **Workspace Type** | "Is this for an organization or personal account?" | `organization` / `user` |
| **Login** | "What is the organization or username?" | e.g., `acme-corp` |

### Deriving from Context

If the current repository is a git repo, we can infer:

```bash
# Get remote origin
REMOTE_URL=$(git remote get-url origin 2>/dev/null)

# Extract owner from GitHub URL
# https://github.com/acme-corp/repo-name → acme-corp
# git@github.com:acme-corp/repo-name.git → acme-corp
if [[ "$REMOTE_URL" =~ github\.com[:/]([^/]+)/ ]]; then
    SUGGESTED_LOGIN="${BASH_REMATCH[1]}"
    echo "Detected GitHub owner: $SUGGESTED_LOGIN"
fi
```

**Always confirm with user** before using derived values.

## Phase 3: Verify Access

Confirm the user has access to the workspace:

```bash
# For organization
gh api "orgs/${WORKSPACE_LOGIN}" --jq '.login' 2>/dev/null
if [[ $? -ne 0 ]]; then
    echo "Cannot access organization: ${WORKSPACE_LOGIN}"
    echo "Check: 1) Spelling  2) gh auth status  3) Organization membership"
    exit 1
fi

# For user (viewer = authenticated user)
gh api user --jq '.login'
```

Get the workspace's GraphQL node ID for later use:

```bash
# Organization
ORG_ID=$(gh api graphql -H X-Github-Next-Global-ID:1 \
    -f query='query($login: String!) { organization(login: $login) { id } }' \
    -f login="$WORKSPACE_LOGIN" --jq '.data.organization.id')

# User
USER_ID=$(gh api graphql -H X-Github-Next-Global-ID:1 \
    -f query='{ viewer { id } }' --jq '.data.viewer.id')
```

## Phase 4: Create Files

### Directory Structure

```bash
mkdir -p .hiivmind/github
```

### config.yaml (Shared)

Create from template with gathered values:

```yaml
# hiivmind-github-skills - Workspace Configuration
# This file is shared across the team and should be committed to git.
# Generated by hiivmind-github-workspace-init on YYYY-MM-DDTHH:MM:SSZ

workspace:
  type: organization           # or "user"
  login: acme-corp
  id: O_kgDOxxxxxxx            # GraphQL node ID

projects:
  default: null
  catalog: []

repositories: []

milestones: {}

cache:
  initialized_at: "2025-12-08T10:00:00Z"
  last_synced_at: null
  toolkit_version: "2.1.0"
```

### user.yaml (Personal)

Create empty template:

```yaml
# hiivmind-github-skills - User Configuration
# This file contains user-specific settings and should NOT be committed to git.
# Add to .gitignore: .hiivmind/github/user.yaml

user:
  login: null
  id: null
  name: null
  email: null

permissions:
  org_role: null
  project_roles: {}
  repo_roles: {}

preferences:
  default_project: null
  default_repo: null

cache:
  permissions_checked_at: null
  permissions_ttl_hours: 24
```

## Phase 5: Gitignore

Check if `.gitignore` exists and suggest adding user config:

```bash
GITIGNORE_LINE=".hiivmind/github/user.yaml"

if [[ -f ".gitignore" ]]; then
    if grep -q "$GITIGNORE_LINE" .gitignore; then
        echo "user.yaml already in .gitignore"
    else
        echo ""
        echo "Add this line to .gitignore to exclude user-specific config:"
        echo "  $GITIGNORE_LINE"
        echo ""
        # Optionally append automatically with user confirmation
    fi
else
    echo "No .gitignore found. Consider creating one with:"
    echo "  echo '$GITIGNORE_LINE' > .gitignore"
fi
```

## Output Summary

After successful initialization:

```
GitHub workspace initialized!

Created:
  .hiivmind/github/config.yaml  (shared, commit this)
  .hiivmind/github/user.yaml    (personal, gitignored)

Workspace: acme-corp (organization)
Workspace ID: O_kgDOxxxxxxx

Next steps:
  1. Add to .gitignore: .hiivmind/github/user.yaml
  2. Run github-workspace-analyze to discover projects and cache IDs
  3. Commit .hiivmind/github/config.yaml to share with team
```

## Multi-Repository Setup

If user wants to share config across multiple repositories:

```bash
# Create centralized config location
mkdir -p ~/github-workspaces/acme-corp/github
# ... run init there ...

# Then in each repo:
ln -s ~/github-workspaces/acme-corp .hiivmind
```

Explain this option if user mentions multiple repositories.

## Error Handling

| Error | Cause | Solution |
|-------|-------|----------|
| "Cannot access organization" | No membership or wrong name | Verify spelling, check `gh auth status` |
| "gh: command not found" | GitHub CLI not installed | Install with `brew install gh` or equivalent |
| "gh: not logged in" | Not authenticated | Run `gh auth login` |
| "Directory exists" | Previous init | Remove `.hiivmind/github/` and retry |

## Reference

- Analyze workspace: `skills/github-workspace-analyze/SKILL.md`
- Refresh workspace: `skills/github-workspace-refresh/SKILL.md`
- Architecture: `docs/meta-skill-architecture.md`
- Config schema: `templates/config.yaml.template`
