# Fixture Recording Manifest
# Defines which fixtures to record from live GitHub APIs and how to sanitize them

# =============================================================================
# METADATA
# =============================================================================

version: "1.0"
last_updated: "2024-12-11"
description: "Test fixture recording manifest for hiivmind-pulse-gh"
# =============================================================================
# TEST INFRASTRUCTURE
# =============================================================================
# Dedicated test repository and project for fixture recording.
# These resources persist and are always ready for testing.
#
# Repository: https://github.com/hiivmind/hiivmind-pulse-test-fixtures (private)
# Project: https://github.com/orgs/hiivmind/projects/3
# Workflow: Hello World (for action fixtures)
# =============================================================================

# Default test targets (can be overridden per fixture)
defaults:
  test_org: "hiivmind"
  test_repo: "hiivmind-pulse-test-fixtures"
  test_project_number: 3
  test_user: null # Will use authenticated user
# =============================================================================
# FIXTURES
# =============================================================================
fixtures:
  # ===========================================================================
  # IDENTITY DOMAIN (GraphQL)
  # ===========================================================================
  identity:
    viewer:
      type: graphql
      description: "Current authenticated user"
      query: |
        query {
          viewer {
            id
            login
            name
            avatarUrl
            bio
            company
            location
            websiteUrl
            createdAt
            updatedAt
          }
        }
      sanitize:
        - path: ".data.viewer.name"
          value: "Test User"
      last_recorded: "2025-12-11T14:35:00Z"
    user:
      type: graphql
      description: "Get user by login"
      query: |
        query($login: String!) {
          user(login: $login) {
            id
            login
            name
            avatarUrl
            bio
            company
            location
            createdAt
          }
        }
      variables:
        login: "discreteds"
      last_recorded: "2025-12-11T14:35:01Z"
    organization:
      type: graphql
      description: "Get organization by login"
      query: |
        query($login: String!) {
          organization(login: $login) {
            id
            login
            name
            avatarUrl
            description
            websiteUrl
            location
            createdAt
          }
        }
      variables:
        login: "hiivmind"
      last_recorded: "2025-12-11T14:35:02Z"
    viewer_with_orgs:
      type: graphql
      description: "Viewer with organization memberships"
      query: |
        query {
          viewer {
            id
            login
            organizations(first: 10) {
              totalCount
              nodes {
                id
                login
                name
                avatarUrl
              }
            }
          }
        }
      last_recorded: "2025-12-11T14:35:03Z"
  # ===========================================================================
  # REPOSITORY DOMAIN (GraphQL)
  # ===========================================================================
  repository:
    repo:
      type: graphql
      description: "Single repository details"
      query: |
        query($owner: String!, $name: String!) {
          repository(owner: $owner, name: $name) {
            id
            name
            nameWithOwner
            description
            url
            sshUrl
            isPrivate
            isFork
            isArchived
            createdAt
            updatedAt
            defaultBranchRef {
              name
            }
            owner {
              login
            }
          }
        }
      variables:
        owner: "hiivmind"
        name: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:12:15Z"
    org_repos:
      type: graphql
      description: "List organization repositories"
      query: |
        query($login: String!, $first: Int!) {
          organization(login: $login) {
            repositories(first: $first, orderBy: {field: UPDATED_AT, direction: DESC}) {
              totalCount
              nodes {
                id
                name
                nameWithOwner
                description
                isPrivate
                createdAt
              }
            }
          }
        }
      variables:
        login: "hiivmind"
        first: 10
      last_recorded: "2025-12-11T14:12:16Z"
  # ===========================================================================
  # MILESTONE DOMAIN (REST)
  # Uses setup/teardown to create deterministic test data
  # ===========================================================================
  milestone:
    list_populated:
      type: rest
      description: "List milestones with test data (uses setup/teardown)"
      endpoint: "/repos/{owner}/{repo}/milestones?state=all&per_page=100"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      setup:
        - resource: milestone
          params:
            title: "Test Milestone v1.0"
            description: "First test milestone for fixture recording"
        - resource: milestone
          params:
            title: "Test Milestone v2.0"
            description: "Second test milestone for fixture recording"
            # teardown is automatic via resource tracking
      last_recorded: "2025-12-11T14:12:27Z"
    list_empty:
      type: rest
      description: "List milestones when none exist"
      endpoint: "/repos/{owner}/{repo}/milestones?state=all&per_page=100"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      setup:
        - action: ensure_empty
          resource: milestone
      last_recorded: "2025-12-11T14:12:29Z"
    list_all:
      type: rest
      description: "List all milestones (open and closed) - current state"
      endpoint: "/repos/{owner}/{repo}/milestones?state=all&per_page=100"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:12:30Z"
    list_open:
      type: rest
      description: "List open milestones only"
      endpoint: "/repos/{owner}/{repo}/milestones?state=open&per_page=100"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:12:32Z"
    list_closed:
      type: rest
      description: "List closed milestones only"
      endpoint: "/repos/{owner}/{repo}/milestones?state=closed&per_page=100"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:12:33Z"
    get_single:
      type: rest
      description: "Get single milestone by number"
      endpoint: "/repos/{owner}/{repo}/milestones/{milestone_number}"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      setup:
        - resource: milestone
          params:
            title: "Single Milestone Test"
            description: "Milestone for single-get fixture"
          capture: milestone_number
      last_recorded: "2025-12-11T14:13:11Z"
  # ===========================================================================
  # ISSUE DOMAIN (GraphQL)
  # ===========================================================================
  issue:
    repo_issues:
      type: graphql
      description: "List repository issues with test data"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      query: |
        query($owner: String!, $name: String!, $first: Int!) {
          repository(owner: $owner, name: $name) {
            issues(first: $first, orderBy: {field: UPDATED_AT, direction: DESC}) {
              totalCount
              nodes {
                id
                number
                title
                body
                state
                createdAt
                updatedAt
                author {
                  login
                }
                labels(first: 10) {
                  nodes {
                    name
                    color
                  }
                }
                assignees(first: 5) {
                  nodes {
                    login
                  }
                }
                milestone {
                  title
                  number
                }
              }
            }
          }
        }
      variables:
        owner: "hiivmind"
        name: "hiivmind-pulse-test-fixtures"
        first: 10
      setup:
        - resource: issue
          params:
            title: "Test Issue for Fixtures"
            description: "This is a test issue created for fixture recording"
        - resource: issue
          params:
            title: "Another Test Issue"
            description: "Second test issue with different content"
      last_recorded: "2025-12-11T14:20:10Z"
  # ===========================================================================
  # PR DOMAIN (GraphQL)
  # ===========================================================================
  pr:
    repo_prs:
      type: graphql
      description: "List repository pull requests with test data"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      query: |
        query($owner: String!, $name: String!, $first: Int!) {
          repository(owner: $owner, name: $name) {
            pullRequests(first: $first, orderBy: {field: UPDATED_AT, direction: DESC}) {
              totalCount
              nodes {
                id
                number
                title
                body
                state
                isDraft
                createdAt
                updatedAt
                author {
                  login
                }
                headRefName
                baseRefName
                mergeable
                labels(first: 10) {
                  nodes {
                    name
                  }
                }
              }
            }
          }
        }
      variables:
        owner: "hiivmind"
        name: "hiivmind-pulse-test-fixtures"
        first: 10
      setup:
        - resource: pr
          params:
            title: "Test PR for Fixtures"
      last_recorded: "2025-12-11T14:20:23Z"
  # ===========================================================================
  # PROJECT DOMAIN (GraphQL)
  # ===========================================================================
  project:
    org_project:
      type: graphql
      description: "Organization project with items (Test Fixtures Project #3)"
      query: |
        query($login: String!, $number: Int!) {
          organization(login: $login) {
            projectV2(number: $number) {
              id
              title
              shortDescription
              public
              closed
              createdAt
              updatedAt
              items(first: 20) {
                totalCount
                nodes {
                  id
                  type
                  createdAt
                  content {
                    ... on Issue {
                      id
                      title
                      number
                    }
                    ... on PullRequest {
                      id
                      title
                      number
                    }
                  }
                }
              }
              fields(first: 20) {
                nodes {
                  ... on ProjectV2Field {
                    id
                    name
                    dataType
                  }
                  ... on ProjectV2SingleSelectField {
                    id
                    name
                    dataType
                    options {
                      id
                      name
                    }
                  }
                }
              }
            }
          }
        }
      variables:
        login: "hiivmind"
        number: 3
      last_recorded: "2025-12-11T14:14:52Z"
  # ===========================================================================
  # PROTECTION DOMAIN (REST)
  # ===========================================================================
  protection:
    branch_protection:
      type: rest
      description: "Branch protection rules for default branch"
      endpoint: "/repos/{owner}/{repo}/branches/main/protection"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
    rulesets:
      type: rest
      description: "Repository rulesets"
      endpoint: "/repos/{owner}/{repo}/rulesets"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
  # ===========================================================================
  # ACTION DOMAIN (REST)
  # ===========================================================================
  action:
    workflows:
      type: rest
      description: "List repository workflows"
      endpoint: "/repos/{owner}/{repo}/actions/workflows"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:14:57Z"
    runs:
      type: rest
      description: "List workflow runs"
      endpoint: "/repos/{owner}/{repo}/actions/runs?per_page=10"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:14:59Z"
  # ===========================================================================
  # VARIABLE DOMAIN (REST)
  # ===========================================================================
  variable:
    list_repo_variables:
      type: rest
      description: "List repository variables"
      endpoint: "/repos/{owner}/{repo}/actions/variables"
      method: "GET"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      last_recorded: "2025-12-11T14:15:01Z"
  # ===========================================================================
  # RELEASE DOMAIN (GraphQL)
  # ===========================================================================
  release:
    releases_list:
      type: graphql
      description: "List releases with test data"
      test_org: "hiivmind"
      test_repo: "hiivmind-pulse-test-fixtures"
      query: |
        query($owner: String!, $name: String!, $first: Int!) {
          repository(owner: $owner, name: $name) {
            releases(first: $first, orderBy: {field: CREATED_AT, direction: DESC}) {
              totalCount
              nodes {
                id
                name
                tagName
                description
                createdAt
                publishedAt
                isDraft
                isPrerelease
                isLatest
                author {
                  login
                }
                releaseAssets(first: 10) {
                  totalCount
                  nodes {
                    name
                    size
                    downloadCount
                  }
                }
              }
            }
          }
        }
      variables:
        owner: "hiivmind"
        name: "hiivmind-pulse-test-fixtures"
        first: 10
      setup:
        - resource: release
          params:
            tag_name: "v0.0.1-test"
            name: "Test Release for Fixtures"
            body: "This is a test release created for fixture recording"
      last_recorded: "2025-12-11T14:20:30Z"
